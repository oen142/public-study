# 웹을 안전하게 하는 HTTPS

- HTTP의 약점
    - 평문이기 때문에 도청이 가능하다.
    - 통신 상대를 확인하지 않기 때문에 위장이 가능하다.
    - 완정성을 증명할 수 없기 때문에 변조가 가능하다.
- HTTP+암호화+인증+완전성 보호 = HTTPS
- HTTP에 암호화와 인증과 완정성 보호를 더한 HTTPS
- HTTP는 SSL의 껍질을 덮어쓴 HTTP
- 상호간에 키를 교환하는 공개키 암호화 방식
- 공개키가 정확한지 아닌지를 증명하는 증명서
- 안전한 통신을 하는 HTTPS의 구조



## HTTP의 약점

- 평문(암호화를 하지 않음) 통신이기 때문에 도청이 가능하다.
- 통신 상대를 확인하지 않기 때문에 위장이 가능하다.
- 완정성을 증명할 수 없기 때문에 변조가 가능하다.

HTTP를 사용한 리퀘스트나 리스폰스 통신 내용은 HTTP 자신을 암호화 하는 기능은 없다.
그래서 통신 전체가 암호화 되지는 않는다. 그렇기에 평문으로 보낸다.

- TCP/IP는 도청이 가능한 네트워크다.
    - 인터넷은 전 세계를 경유하는 네트워크로 되어 있다.
    - 어느 서버와 클라이언트가 통신을 할때 통신 경로 상에 있는 네트워크 기기나 케이블이나 컴퓨터 등을 전부 자기 자신이 소유하고 있을수는 없다.
    - 암호화 통신은 메시지 속의 의미는 알 수는 없다.
    - 암호화된 메시지 자체는 엿볼 수 있다.
- 암호화로 도청을 피해야한다.
    - 통신 암호화
        - HTTP에는 암호화 구조는 없지만 SSL이나 TSL이라는 다른 프로토콜을 조합함으로써 HTTP통신의 내용을 암호화 할수있다.
        - SSL등을 이용해 안전한 통신로를 확립하고나서 그 통신로를 사용해 HTTP통신을 합니다. SSL을 조합한 HTTP를 HTTPS또는 HTTP over SSL이라고 불린다.
    - 콘텐츠 암호화    
        - 콘텐츠 내용 자체를 암호화 하는것이다.
        - HTTP에 암호화 하는 기능이 없기 때문에 HTTP를 사용해서 운반하는 내용을 암호화 하는것이다.
        - 클라이언트에서 HTTP 메시지를 암호화해서 출력하는 처리가 필요하게 된다.
        - 콘텐츠의 암호화를 유효하게 하기 위해서는 클라이언트와 서버가 콘텐츠의 암,복호화구조를 가지고 있어야하므로 평상시에 유저가
         사용하는 브라우저와 웹 서버에서는 사용하기가 어렵다.
 
 ##통신 상태를 확인하지 않기 때문에 위장이 가능하다. 
 HTTP를 사용한 리퀘스트나 리스폰스에서는 통신 상대를 확인하지 않는다. 리퀘스트를 보낸 서버가 정말로 URI에서 지정된 호스트인지 아닌지,
 리스폰스를 반환한 클라이언트가 정말로 리퀘스트를 출력한 클라이언트인지를 모른다
 
 - 누구나 리퀘스트 할 수 있다.
 HTTP에 의한 통신에는 상대가 누구인지 확인하는 처리가 없다. 그래서 누구든지 리퀘스트를 보낼수가 있다.
 리퀘스트가 오면 상대가 누구든지 무언가의 리스폰스를 반환한다.(단 , IP주소나 포트등에서 그 웹서버에 액세스 제한이 없는 경우)
 
 HTTP는 누구이던 간에 리퀘스트를 보내면 리스폰스가 반환되는 매우 심플한 구조로 되어있다. 하지만 이것이 약점이다.
 - 리퀘스트를 보낸 곳의 웹 서버가 원래 의도한 리스폰스를 보내야하는 웹서버인지 아닌지를 확인할 수가 없다.
 - 리스폰스를 반환한 곳의 클라이언트가 원래 의도한 리퀘스트를 보낸 클라이언트인지 아닌지를 확인 할 수가 없다.
 - 통신하고 있는 상대가 접근이 허가된 상대인지 아닌지를 확인할 수 없다. 중요한 정보를 가진 웹서버에서는 특정
 상대만 통신을 허가하고 싶을때가 있다.
 - 어디의 누가 리퀘스트를 했는지 확인 할 수가 없다.
 - 의미없는 리퀘스트라도 수신하게 된다. 대량의 리퀘스트에 의한 DoS공격을 방지할 수가 없다.
 
 
 #### 상대를 확인하는 증명서
 HTTP에서는 통신 상대를 확인할 수 없지만 SSL로 상대를 확인할 수가 있다. SSL은 암호화뿐만이 아니라 상대를 확인하는 수단으로
 증명서를 제공하고 있다.
 증명서는 신뢰할 수 있는 제 3자 기관에서 의해 발행되는 것이기 때문에 서버나 클라이언트가 실재하는 사실을 증명합니다.
 또 그 증명서를 위조하는 것은 기술적으로 상당히 어렵다. 통신 상대의 서버나 클라이언트가 가진 증명서를 확인함으로써 통신 상대가
 내가 통신하고자 하는 상대인지 아닌지를 판단할 수 있다.
 이 증명서를 이용함으로써 통신 상대가 내가 통신하고자 하는 서버임을 나타내고 이용자는 개인 정보 누설등의 위험성이 줄어든다.
 또한, 클라이언트가 증명서를 가짐으로써 본인 확인을 하고 웹 사이트 인증에서 이용할 수도 있다.
 
 ##완정성을 증명할 수 없기 때문에 변조가 가능하다.
 완전성이란 정보의 정확성을 가리킵니다. 그것을 증명할 수 없다는 것은 정보가 정확한지 아닌지를 확일할 수 없음을 의미한다.
 
 - 수신한 내용이 다를수도 있다.
HTTP가 완전성을 증명할 수 없다는 뜻은 만약 리퀘스트나 리스폰스가 발신 된 후에 상대가 수신할 때 까지의 사이에 변조가 되었다고 해도
이 사실을 알 수 없다. 이러한 공격을 중간자 공격이라고 부른다.

#### 변조를 방지하려면?
HTTP를 사용해서 완전성을 확인하는 방법은 확실한 방법은 현재로서 없다. 그중에서도 자주 사용되고 있는 방법은
`MD5` ,`SHA-1`등의 해시값을 확인하는 방법과 파일의 디지털 서명을 확인하는 방법이다.
파일 다운로드 서비스를 제공하고 있는 웹사이트에서는 PGP에 의한 서명과 MD5에 의한 해시값을 제공하는 일이 있따.
PGP는 파일을 작성했다는 증명을 위한 서명이고, MD5는 단방향성 함수에 의한 해시값 이다. 어느쪽을 사용하더라도
클라이언트를 이용하고 있는 유저 자신이 다운로드 받은 파일을 토대로 검사할 필요가 있다.
브라우저에서 자동적으로 검사할 수가 없다.
확실히 방지하기 위해서는 HTTPS를 사용해야한다. SSL에는 인증이나 암호화, 그리고 다이제스트 기능을 제공하고 있따.
HTTP만으로는 완전성을 보증하는 것이 어렵기 때문에 다른 프로토콜을 조합함으로써 실현하고 있다.

## HTTP+암호화+인증+완전성 보호 = HTTPS

#### HTTP에 암호화와 인증과 완전성 보호를 더한 HTTP
HTTP통신은 암호화 하지않은 평문으로 실시된다. 또한 HTTP에는 통신 상대의 서버나 클라이언트를 인증하는 수단이 없다.
실제로는 의도한 통신 상대와 통신하고 있지 않을 가능성이있다. 또한 수신한 메시지가 도중에 변조되어 있을 가능성도 있다.
이러한 문제를 해결하기 위해서는 암호화와 인증과 완전성 보호같은 구조를 HTTP에 추가할 필요가 있따.
그것이 HTTPS이다.

HTTPS를 사용하는 통신은 웹페이지의 로그인이나 쇼핑의 결제 화면등에서 사용되고 있다.
URI에서 `http://`가 아닌 `https://`를 사용한다. 또한 브라우저에서 HTTPS가 유호한 웹 사이트에 접속을 하면
자물쇠 마크가 표시된다.

## HTTPS는 SSL의 껍질을 덮어쓴 HTTP

HTTPS는 새로운 애플리케이션 계층의 프로토콜은 아니다. HTTP통신을 하는 소켓 부분을 SSL이나 TSL이라는 프로토콜로 대체하고 있을 뿐이다.

보통 HTTP는 직접 TCP와 통신을 하지만 SSL을 사용한 경우에는 HTTP는 SSL과 통신하고 SSL이 TCP와 통신을 하게 된다.
SSL을 사용함으로써 HTTP는 HTTPS로서 암호화와 증명서와 완전성 보호를 이용할 수 있게 된다.SSL은 HTTP와는 독립된 프로토콜로
HTTP만으로는 애플리케이션 계층에서 동작하는 SMPT나 텔넷등에서도 사용할 수 있다.

## 상호간에 키를 교환하는 공개키 암호화 방식

현대의 암호는 알고리즘이 공개되어 있고 키를 비밀에 부침으로써 안전성을 유지한다. 암호화나 복호화할때 이키를 사용한다.
키가 없으면 암호를 풀수는 없지만 반대로 키를 가지고 있다면 누구든지 암호를 풀 수가있다.
공격자가 키를 알게 되면 암호화가 의미를 잃어버리게 된다.

#### 공통키 암호의 딜레마
암호화와 복호화에 하나의 키를 같이 사용하는 방식을 공통키 암호라고 부른다.
공통키 암호화 방식은 상대방에게 키를 넘겨주지 않으면 안된다.
네트워크를 사용해서 키를 넘길때 통신이 도청되어 공격자에게 키를 빼앗기게 되면 암호화의 의미가 없어진다.
또한 받은키를 안전하게 보관하기 위한 노력을 하지 않으면 안된다.

#### 두개의 키를 사용하는 공개키 암호
공통키 암호의 문제를 해결하기 위해 공개키 암호를 사용한다.
공개키 암호에서는 서로 다른 두개의 키페어를 사용한다. 한쪽은 비밀키라고 부르고 다른 한쪽은 공개키 라고 부른다.
공개키는 알려저도 상관없지만 비밀키는 알려지면 안된다.
공개키 암호를 사용한 암호화는 암호를 보내는 측이 상대의 공개키를 사용해 암호화를 시작한다. 그리고 암호화된 정보를 받아들인 상대는
자신의 비밀키를 사용해 복호화를 실시한다. 이 방식은 암호를 푸는 비밀키를 통신으로 보낼 필요가 없기 때문에 도청에 의해서 키를 빼앗길 걱정이 없다.

#### HTTPS는 하이브리드 암호 시스템
HTTP는 공통키 암호화 공개키 암호의 양쪽 성질을 가진 하이브리드 암호 시스템이다. 키를 안전하게 교환할 수만 있다면 공개키 암호마능ㄹ 사용해서
통신을 해도 상관없다고 생각하겠지만, 공개키 암호는 공통키 암호에 비해 처리 속도가 늦다.
거기서 두가지 장점을 살릴수 있도록 각각의 방식을 조합해서 통신한다. 키를 교환하는 곳에서는 공개키 암호를 사용하고,
그후 통신에서 메시지를 교환하는 곳에서는 공통키 암호를 사용한다.

## 공개키가 정확한지 아닌지를 증명하는 증명서
공개키 암호에도 문제점이 있다. 공개키가 진짜인지 아닌지를 모른다. 이 문제를 해결하는 인증기관이 있따.
그 기관이 발행하는 공개키 증명서가 이용되고 있다. 인증기관이란, 클아이언트와 서버가 모두 신뢰하는 제 3자 기관이다.
인증기관 이용은 다음과 같다.
1. 먼저서버의 운영자가 인증 기관에 공개키를 제출한다.
1. 인증 기관은 제출된 공개키에 디지털 서명을 하고 서명이 끝난 공개키를 만든다.
1. 공개키 인증서에 서명이 끝난 공개키를 담는다.
1. 서버는 이 인증 기관에 의해서 작성된 공개키 인증서를 클라이언트에 보내고 공개키 암호로 통신을 한다.`공개키 인증서는 디지털 증명서나 줄여서 증명서라고 부른다.`
1. 증명서를 받은 클라이언트는 증명 기관의 공개키를 사용해 서버의 공개키를 인증한것이  진짜 인증기관이라는것과 서버의 공개키가 신뢰할 수 있다는 것을 알수 있다.

인증기관의 공개키는 안전하게 클라이언트에게 전달되어야 한다.
통신중에는 어떤 방법을 사용하더라도 안전하게 전달하는 것은 어렵기 때문에 브라우저가 주요 인증 기관의 공개키를 사전에 내장한 상태로
제품을 내놓는다.

#### 조직의 실제성을 증명하는 EV SSL 증명서
증명서의 역할은 서버가 올바른 통신 상대임을 증명하는 것이지만, 상대방이 실제로 있는 기업인지를 확인하는 역할도 있다.
그러한 역할을 가진 증명서를 EV SSL증명서라고한다.
EV SSL증명서는 세계 표준의 인정 가이드라인에 의해서 발행되는 증명서 이다.
운영하는 조직의 실재성을 확인하는 방법을 엄격히 규정하고 있기 때문에 웹사이트의 신뢰성을 더욱 더 높일 수 있다.
브라우저의 주소창이 녹색으로 변화면 EV SSL증명으로 증명된 웹 사이트인것을 알 수 있다.

#### 클라이언트를 확인하는 클라이언트 증명서
HTTPS에서는 클라이언트 증명서도 이용할 수 있다. 클라이언트 증명서를 이용하여 서버 증명서와 같이 서버가 통신하고
있는 상대가 의도한 클라이언트인지 증명하는 클라이언트 인증을 할 수 있다.

클라이언트 증명서에는 몇가지 문제점이 있다.
- 클라이언트 증명서의 입수와 배포.
- 유저가 클라이언트 증명서를 인스톨할 필요가 있다.
- 클라이언트 증명서는 유료로 구입할 필요가 있기 때문에 유저수 만큼이나 비용이 든다.
- 여러 유저가 인스톨 작업을 해야하는것도 일이다.

안전성이 매우 높은 인증 기능을 제공 할 수 있지만 특정 용도로 사용되는 실정이다.
클라이언트 인증은 그 만큼 비용을 들일 필요가 잇는곳에서 사용된다.
- 은행 인터넷 뱅킹

#### 인증기관은 신용이 제일
SSL은 인증 기관을 신용할 수 있다는 전제로 이루어져 있다.
하지만 2011년 7월에 가짜 증명서가 발행되어 버린 사건이 발생했다.
이렇게 잘못 발행된 증명서라고 해도 믿을 수 있는 인증 기관의 서명이 있기 때문에
브라우저는 올바른 증명서로서 인식을 한다. 서버로 위장 할 때에 사용되더라도 유저가 알아채기 힘들다.
증명서를 무효화하는 증명서 취소 리스트라는 구조나 루트 인증 기관을 클라이언트에서 삭제하는 대책이 있지만,
효과를 발휘할때 까지 시간이 걸리기 때문에 그 사이에 얼마만큼 유저가 피해를 입을 지는 알 수 없다.

#### 자기 인증 기관 발행 증명서는 나야나 증명서
OpenSSL 등의 소프트웨어를 사용하면 누구든지 인증 기관을 구축해서 서버 증명서를 발행 가능하다.
하지만 이 증명서는 구실을 하지 못한다.
독자적으로 구축한 인증 기관을 자기 인증 기관이라고 부른다.
브라우저에 엑세스하면 `접속의 안전성을 확인할 수 없습니다.` ,  `이 사이트의 보안 증명서에는 문제가 있습니다.`등의 경고 메시지를 볼 수 있따.
마이너 인증 기관을 사용해도 그러한 증상이 나타날 수 있다.

