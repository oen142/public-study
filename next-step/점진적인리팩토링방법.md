### 점진적인 리팩토링
TDD 리팩토링 연습과정

- 레거시 코드를 리팩토링이랑 TDD를 적용하는게 어렵다.
- 근데 그런 책들을 보면 레거시 코드에 적용을 하기때문에 우리가 포기한다.
- 마지막 단계이다. 그걸 하기위해서 우리는 하는것이다.

- AS-IS
    - 학습 테스트 - JUnit사용법 및 단위 테스트 연습
    - 단위 테스트 - 내가 구현한 코드에 대한 단위 테스트
    - TDD- 

- TO-BE - 점진적으로 리팩토링하기
    - 레거시 코드 리팩토링
    - 레거시 코드리팩토링의 핵심은 기존 기능을 깨지않고 리팩토링 하는것
- 점진적인 리팩토링이란?
    - 기존의 TestCase가 깨지지 않는 상태로 리팩토링 하기
    - 컴파일 에러 발생을 최소화 하면서 리팩토링 하기

- 우리가 마주하는 상황1
    - 메소드에 인자가 추가되었다.
    - 메소드를 사용하는 모든곳에서 컴파일 에러가 발생한다.
    - 테스트 코드 포함 컴파일 에러를 해결한다.
    - 테스트를 실행했더니 테스트가 깨지는 Test Case가 발생한다.
    - 디버깅을 한다.
- 우리가 마주하는 상황2
    - 인스턴스 변수의 타입을 String에서 Integer로 변경했다.
    - 변수를 사용하는 모든곳에서 컴파일 에러가 발생한다.
    - 테스트 코드 포함 컴파일 에러를 해결한다.
    - 테스트를 실행했더니 테스트가 깨지는Test Case가 발생한다.
    - 디버깅을 한다.

- 만약 그 메서드를 사용하는 군데가 10곳이면 10곳을 바꾸고 다시 테스트를 해봐야한다.
- 위 방식으로 리팩토링을 하면 테스트에 대한 긍정적인 측면 보다는 오히려 부정적인 측면이 생길수 있다.

- 테스트 하기 위해서 테스트 코드를 호출하는 메서드가 10곳이 생긴다.테스트코드를 추가하면 의존성이 추가한다.
- 테스트코드가 없으면 줄어들텐데 테스트코드를 넣으면 많아진다 그러니까 테스트코드를 부정적으로 생각하고 거부감이 든다.
- 이렇게 해서 10군데 테스트하고 바꾸는데 시간이 너무많이 걸린다. 1시간 30분이 걸리면 좋은데
- 3시간 1일이 걸리기도 하는데 이걸 못한다.

- 리팩토링을 생활화 하려면 그 시간이 짧아야 한다.
- 컴파일 에러가 발생하는 시간이 적어야 된다.
- 리팩토링하는 코드가 바로 배포가 되어야 한다.

#### 우리가 연습해야할 리팩토링은?
- 기존 코드에 컴파일 에러가 발생하지 않도록 리팩토링 하는 연습을 해야한다.
- 리팩토링 과정에서 테스트 코드가 깨지지 않도록 리팩토링하는 연습을 해야한다.

- 위 두가지 원칙을 지키면서 리팩토링을 하려면 과도기적인 중간단계가 있어야 한다.
- 잘 하게되면 소스코드 리팩토링과 데이터베이스 리팩토링을 같이 할수있다.

#### 메소드에 인자가 추가되는 경우
- 변경하려는 메소드를 그대로 복사해 메소드 이름을 임시로 변경한다.
- 예를 들어 match() 메소드라면 match2()와 같이 임시로 구현한다.
- match() 메소드를 사용하는 모든 코드가 match2()를 사용하도록 변경한다.
- match() 메소드를 사용하는 코드가 더 이상 존재하지 않으면 match()를 제거한다.
- match2() 메소드를 match()로 이름을 변경한다.

#### 인스턴스 변수의 타입이 변경되는 경우
- 새로운 타입의 인스턴스 변수를 추가한다.
- 예를들어 String 에서 Integer로 변경한다면 일시적으로 두개의 타입을 동시에 가진다.
- 두개의 변수에 동시에 데이터를 할당하고 변경하도록 변경한다.

- 데이터베이스 구조 변경시 A->B로 이동하려면 점검을 걸어야 한다.
- 우리가 점검을 걸지 않으면서 무중단 배포를 하려면 A -> B지점으로 바꿀 것을 동시에 같이 쌓는다.
- 일정 기간동안 서비스를 운영한다.
- 날려야할 데이터들을 날려버린다.
- 배포를 2번해야한다. 무중단배포없이 서비스를 점검하려면

우리가 AWS를 쓴다고 해서 무중단 배포만 하는게 아니다.
Nosql을 쓰게 되면 2번배포안해도 어플리케이션레벨에서 변경이 가능하다.


#### 점진적인 리팩토링 - TDD에 대한 감이 생길때 한번씩 도전
- 1단계 - 메소드를 다른 클래스로 이동
- 2단계 - 메소드에 인자 타입이나 수 반환값이 변경되는 경우
- 3단계 - 인스턴스 변수(필드)의 타입이 변경되는 경우

한번에 변경하는게 아니라 단계적으로 바꾸는것이 중요하다.


#### 로또 미션 리팩토링
- 랭크클래스에서 랭크 메소드를 바꾸려면
- 랭크 클래스를 도출 테스트 작성
- 만족시키는 RankClass 만듦
- 2등의 기능을 추가하는 리팩토링
- 메소드 이동후 


- 테스트의 중복들이 발생한다.
- 메소드에서 클래스로 이동하게 되면
- 내가 필요없다고 생각되는 테스트케이스를 삭제해도 된다.
- 내가 불안함이 적으면 적을수록 테스트가 줄어들어야 한다.


- 클래스가 캡슐화되서 외부로 노출이 안되면,
- Lotto 클래스가 내부만 적용된다면, 잘한거다.

- 리팩토링은 모았다가 한번에 하는게 아니라
- 시간날때 마다 하는것이다.
- 1주일동안 리팩토링할 시간을 달라하는게 아니라, 그러면 일주일간만 리팩토링만 했다고 얘기한다고 하면
바뀐게 없기 때문에 욕먹을수 있다.
- 딴짓하는 시간이 많은데, 그 시간에 짬짬히 리팩토링 하는것이다. 머리 식힐용도로
- 인텔리제이켜놓고 뭔가 하면 좋아한다 팀장이 ㅋㅋㅋ


- 점진적으로 리팩토링 하는 역량을 꾸준히 쌓는것이
지금까지 학습한 TDD 리팩토링 클린코드 OOP가 현장의 애플리케이션 개발에 의미를 가지는 유일한 길이다.
