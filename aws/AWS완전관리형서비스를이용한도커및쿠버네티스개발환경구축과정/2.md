## AWS 고가용성 환경 구축 - ASG, ELB, Multi-AZ, Global Region 구성 실습
- 저번주 상기
    - EC2
        - COMPUTE 환경 cpu 메모리 제공
    - VPC
        - 보안을 위해 private한 클라우드 환경 제공
        - 구글의 클라우드 플랫폼에도 있고 에저에도 있다.
        - 프로토콜을 규약을 맞추는 것처럼 다 있다.
    - EBS
    - AMI
    - 위을 잘 이해하면 어떤 클라우드 환경으로 가도 쉽게 된다.
    - 오픈스택을 쓸수도 있다.
    
    - 스토리지 백업 , 복사 , 스냅샷 다른 리전으로 옮긴다.
    - 패스워드를 잃어버렸을때 (key pair) 인스턴스가 물고 있는 저장하는 스토리지를 접근 할 수가 없다. 인스턴스키가없어서
        - EC2는 껍데기에 불과 , 뺏다가 끼는 방식 AWS측에서도 하라고 제공
    
        
            
- 오늘 할 부분
    - 루트 사용자로서 다른 직원들이나 동료들에게 내 계정 안에서 아이디와 패스워드를 만들고 권한같은게 있어서 줄 수 있도록 한다.
    - CLI라고 해서 리눅스베이스에서 사용 EC2 , VPC , AMI EBS 콘솔에서 사용하는것이 아니라 CLI 방식으로 한다.
        - CLI를 활용하는 이유는 자동화 때문에 엔서블
        - 자동화의 말에 대부분 스크립트 이다. 순차적으로 명령어를 통해서 할것. yml ,json으로 스크립트 사용
    - 급한대로 사용할 수 있는 윈도우 환경의 AWS환경
    
    

## IAM(Identity and Access Management)
  
- 서비스에 대한 엑세스를 안전하게 제어하는 웹 서비스
- 사용자, 엑세스 키와 같은 보안 자격증명, 사용자와 어플리케이션이 어떤 AWS 리소스에 엑세스 할 수 있는지 제어하는 권한을 한곳에서 관리

- 오늘 만들것
    - USER
    - GROUP   
    - 서비스 어떤 범위까지 사용할 수 있는지(ROLE)
    
    - 크리덴셜 - Key
    - CLI 접근을 통해서 계정을 만듬
    
[1]()


[2]()

- 녹색 V자가 좋은거고
- 느낌표를 녹색으로 만든다 그럼 보안상태가 좋아진다.

- MFA
    - 다요소 인증 (Multi-factor Authentication MFA)
    - 지식 (가장 자주 사용하는것 password)
    - 소유 (갖고 있는거 홍채 , 신체 , 지문)
    - 속성  (보안카드 , OTP)
    - 세가지 요소를 이용해서 2가지 이상을 이용해서 로그인 하면 다요소 인증이다.
    
- 개별 IAM 사용자 생성 이유    
    - 보편적으로 루트 계정을 사용하지 않는다.
    - 아이디 하나 더만들고 루트 계정처럼 만들고 사용한다.
- 1단계    
    - 접근 방법이 2개
        - CLI SDK API 도구에 대해 엑세스 키 ID 비밀 엑세스키 활성화
        - ManagementConsole 
    - 자동 생성된 패스워드를 한번 사용하고 자기가 원하는 패스워드를 바꾸는 방식

- 2단계
    - 그룹에 사용자 추가
    - 기존 사용자에서 권한 복사
    - 기존 정책 직접 연결
        - AdministratorAccess
        - 하나의 유저를 원하는 API에 엑세스를 할수 있는 권한을 준다.

- csv 내용
    - user name
    - password
    - Access key ID
    - Secret access key
    - Console login link
    
- IAM 비밀 번호 정책 적용

## AWS CLI 환경 구축

- credential 적용
    - aws configure
- VPC와 서브넷 만들기
    - aws ec2 create-vpc --cidr-block 10.0.0.0/16 --output table
    - aws ec2 describe-vpcs
    - MY_VPC = vpc-0dda8e0965ac6cf5e
    - aws ec2 create-subnet --vpc-id vpc-0dda8e0965ac6cf5e --cidr-block 10.0.0.0/20 --availability-zone ap-northeast-2a --output table
    - aws ec2 create-subnet --vpc-id vpc-0dda8e0965ac6cf5e --cidr-block 10.0.16.0/20 --availability-zone ap-northeast-2b --output table
    - aws ec2 create-subnet --vpc-id vpc-0dda8e0965ac6cf5e --cidr-block 10.0.32.0/20 --availability-zone ap-northeast-2c --output table
    - aws ec2 describe-subnets --filters "Name=vpc-id,Values=vpc-0dda8e0965ac6cf5e" --query 'Subnets[*].{AZ:AvailablilityZone,CIDR:CidrBlock}' --output table     

- 서브넷을 퍼블릿 서브넷으로 만들기
    - aws ec2 create-internet-gateway
    - MY_IGW = igw-0dde7573e17a32bcb
    - aws ec2 attach-internet-gateway --vpc-id vpc-0dda8e0965ac6cf5e --internet-gateway-id igw-0dde7573e17a32bcb
    - aws ec2 describe-internet-gateways
    - aws ec2 create-route-table --vpc-id vpc-0dda8e0965ac6cf5e
    - aws ec2 describe-route-tables
    - MY_RTB = rtb-02f38665dad67d267
    - aws ec2 create-route --route-table-id rtb-02f38665dad67d267 --destination-cidr-block 0.0.0.0/0 --gateway-id igw-0dde7573e17a32bcb
    - aws ec2 describe-route-tables --route-table-id rtb-02f38665dad67d267
    - aws ec2 describe-subnets --filters "Name=vpc-id,Values=vpc-0dda8e0965ac6cf5e" --query 'Subnets[*].{ID:SubnetId,CIDR:CidrBlock}'  
    - aws ec2 associate-route-table --subnet-id subnet-01f79f36672a79ba4 --route-table-id rtb-02f38665dad67d267
    - aws ec2 associate-route-table --subnet-id subnet-0cffd56e316220c35 --route-table-id rtb-02f38665dad67d267
    - aws ec2 associate-route-table --subnet-id subnet-039d676652d8d1a33 --route-table-id rtb-02f38665dad67d267
    - aws ec2 modify-subnet-attribute --subnet-id subnet-01f79f36672a79ba4 --map-public-ip-on-launch
    - aws ec2 modify-subnet-attribute --subnet-id subnet-0cffd56e316220c35 --map-public-ip-on-launch
    - aws ec2 modify-subnet-attribute --subnet-id subnet-039d676652d8d1a33 --map-public-ip-on-launch
    - aws ec2 modify-vpc-attribute --vpc-id vpc-0dda8e0965ac6cf5e --enable-dns-hostnames
    
- 키페어, 보안그룹 만들기
    - aws ec2 create-key-pair --key-name MyKeyPair --query 'KeyMaterial' --output text > MyKeyPair.pem
    - chmod 400 MyKeyPair.pem
    - aws ec2 create-security-group --group-name HTTP_SSHAccess --description "Security group for HTTP_SSH access" --vpc-id vpc-0dda8e0965ac6cf5e
    - MY_SG = sg-0cc77ae059bad1d82
    - aws ec2 describe-security-groups
    - MY_IP=$(curl http://checkip.amazonaws.com) //59.9.140.136
    - aws ec2 authorize-security-group-ingress --group-id sg-0cc77ae059bad1d82 --protocol tcp --port 22 --cidr 59.9.140.136/32
    - aws ec2 authorize-security-group-ingress --group-id sg-0cc77ae059bad1d82 --protocol tcp --port 80 --cidr 0.0.0.0/0
    
    
- 볼륨 및 인스턴스 만들기
    - aws ec2 run-instances --image-id ami-0e92198843e11ccee --count 1 --instance-type t2.micro --key-name MyKeyPair --security-group-ids sg-0cc77ae059bad1d82 --subnet-id subnet-01f79f36672a79ba4 --block-device-mappings file://mapping.json

    - MY_IID=i
    - aws ec2 describe-instances --instance-id $MY_IID
    - ssh -i "MyKeyPair.pem" ec2-user@


- 정리
    - aws ec2 terminate-instances --instance-id $MY_IID
    - aws ec2 delete-security-group --group-id $MY_SG
    - aws ec2 delete-subnet --subnet-id $MY_SID1
    - aws ec2 delete-subnet --subnet-id $MY_SID2
    - aws ec2 delete-subnet --subnet-id $MY_SID3
    - aws ec2 delete-route-table --route-table-id $MY_RTB
    - aws ec2 detach-internet-gateway --internet-gateway-id $MY_IGW --vpc-id $MY_VPC
    - aws ec2 delete-internet-gateway --internet-gateway-id $MY_IGW
    - aws ec2 delete-security-group --group-id $MY_SG
    - aws ec2 delete-vpc --vpc-id $MY_VPC
    
```json
[
  {
    "DeviceName": "/dev/xvda",
    "Ebs": {
      "VolumeSize": 10
    } 

  },
  {
    "DeviceName": "/dev/sdh",
    "Ebs": {
      "VolumeSize": 10
    }


  }
]
```
    
    
#### AWS 스토리지 서비스및 생성  




#### AWS 보안 아키텍쳐 이해 




#### AWS 환경설계 이해 





#### AWS고가용성 환경구축 
