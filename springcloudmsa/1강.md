https://www.youtube.com/watch?v=D6drzNZWs-Y&list=PL9mhQYIlKEhdtYdxxZ6hZeb0va2Gm17A5


모놀리틱 아키텍쳐

aws가 없던 시절 E-commerce 스타트업 시작
- 이름 : 12번가
- 업종 : 오픈마켓
- 개발자 3명


개발자가 있다. 로컬에서 소스코드를 코딩하고 톰캣으로 실행
DB에 12번가 비지니스가 저장되어있다.

개발자 3명
로컬에 3개 톰캣 디비는 보통 하나만 써서 모든 상태를 저장
코드에 대한 형상관리 
상용을 오픈을 할때 배포(스크립트 , 톰캣매니저)를 사용해서 배포

앱에서는 api , json 통신 데스크탑에서는 html, jpg등등 서비스를 했다

최초 상용배포
톰캣 1대, 이비 1대구입 SCP를 통해 Clean배포 (stop -> delivey->start)
DNS(12st.com) -> Tomcat
무중단 배포 불가능!

톰캣 한개더 구입하고 앞에는 로드밸런서를 구입 (돈이 많으면 L4 , 돈이 없으면 Nginx HProxy)
HA구성(High Avali) 지속적으로 구동되는 시스템 높은 가용성을 가진 시스템

LB OUT -> tomcat stop -> delivery -> tomcat start -> LB IN
장점이 많다. 정적파일도 캐시해놓고 빠르게 리소스를 덜 잡아먹는다. 로드가 실제로 들어오는게 많아져도
각자의 톰캣에 들어가게 함.

서버 1대추가구입
HA(High Avaliability) 구성 -지속적으로 구동되는(upTime) 시스템 
Load Balancer - L4 switch(hardware) ,L7 (Nginx , HAProxy)


서버 3대 추가구입
LB 설정 변경 , 배포 방식 변경 (Jenkins ,Ansible , Chef, etc )
전체 배포 시간이 늘어나지만 서비스가 괜찮으므로  OK

조직 개편 , 상품팀 , 주문팀으로 분리
단일 Repository

문제점 발생
1. Branch Merge시 Conflict
2. QA를 어디까지? - 정기배포일
3. 각자 다른일정 , 배포이슈
4. etc , ...

주문이랑 상품으로 오는걸 다른 서버군을 쓰도록
구성을 했다. 문제는 주문쪽에서는 상품 정보를 가져와야한다.
상품정보를 가져올때 product에 있으니까 소스코드를 떨어져있는걸
참고 불가 share 레포지토리 만들고 다른걸 있으면 share로 호출
실제 대부분 개발은 share 쪽에서 개발한다.
전체적인 싱크를 맞춰야 한다. 정기 배포일에는 하나만 배포
팀별 Repository분리 , 각 코드 commit 시 팀별 배포가능
공통적인 부분들을 Share Repository에 넣음
각 프로젝트에서 compile 한다.
issues : 여전이 정기 배포 필요 (sync)

회사는 더더 성장하는데
- 개발자 150명+
- 회원팀, 상품팀, 주문팀, 셀러팀 ,등등 그리고 지원 조직(DB팀 ,..,)
- 하나의 DB. (share.jar에서 접근해야하고.. 그게 쉬우니까)
- 수백만 라인의 공통 코드 (소스코드만 100MB 이상)
- copy& paste 에서 오는 중복과 복잡도

콘웨이의 법칙

- (광범위하게 정의하면) 모든 조직은 조직의 의사소통 구조와 똑같은 구조를 갖는 시스템을 설계한다.
조직이 같은게 아니라 의사소통 구조가 조직간의 구조가 앱이랑 똑같아진다.
하나의 어플만 띄운다. 주문팀이 상품팀에 물어봐야하고 정산팀에도 물어보게되고..
너무 많은 소통을 해야한다. 위험하고 결정적 장애
- 콘웨이 법칙은 조직도에 초점을 두지 않고, 실질적인 소통 관계에 관심을 둔다. 너무 많은 통신관계를 갖는것은 프로젝트에
대한 진정한 위험이 된다.

모놀리틱 아키텍쳐 정리
- 대부분 IT회사의 시작은 모놀리틱(Amazon,Netflix , 11번가 , etc)
- 장점
    - 개발이 단순하다(repository 하나 체크아웃 받아서 띄우면 되니까./)
    - 배포가 단순하다(war 하나만 배포하면 되니까..)
    - Scale-out 이 단순하다(서버 하나 복사하면 되니까..)
    - 하지만 DB성능으로 인한 한계가있다.
- 단점
    - 무겁다 - IDE가 못받쳐줌
    - 어플리 케이션 시작이 오래걸린다.
    - 기술 스택 바꾸기가 어렵다.
    - 높은 결합도
    - 코드베이스의 책임 한계와 소유권이 불투명
    
이쯤에서는 회사는 결정을 하게 됩니다.
- 새로운 언어 , 깔끔한 코드로 전면 재개편 하거나
    - 차세대 프로젝트, 빅뱅
    - Netscape (ex
- MSA 플랫폼을 구축하며 기존 Legacy를 고사(strangle) 시킵니다.
    - Amazon, Netflix , 11번가 , etc..